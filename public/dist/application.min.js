"use strict";var ApplicationConfiguration=function(){var applicationModuleName="hkt48",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","slick","akoenig.deckgrid","cfp.loadingBar","duScroll","angulartics","angulartics.google.analytics"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","cfpLoadingBarProvider",function($locationProvider,cfpLoadingBarProvider){$locationProvider.hashPrefix("!"),cfpLoadingBarProvider.includeSpinner=!1}]).value("duScrollOffset",50).run(["$rootScope","$state",function($rootScope,$state){$rootScope.$state=$state}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("members"),ApplicationConfiguration.registerModule("users"),angular.module("articles").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Articles","articles","dropdown","/articles(/create)?"),Menus.addSubMenuItem("topbar","articles","List Articles","articles"),Menus.addSubMenuItem("topbar","articles","New Article","articles/create")}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("listArticles",{url:"/articles",templateUrl:"modules/articles/views/list-articles.client.view.html"}).state("createArticle",{url:"/articles/create",templateUrl:"modules/articles/views/create-article.client.view.html"}).state("viewArticle",{url:"/articles/:articleId",templateUrl:"modules/articles/views/view-article.client.view.html"}).state("editArticle",{url:"/articles/:articleId/edit",templateUrl:"modules/articles/views/edit-article.client.view.html"})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(){var article=new Articles({title:this.title,content:this.content});article.$save(function(response){$location.path("articles/"+response._id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){if(article){article.$remove();for(var i in $scope.articles)$scope.articles[i]===article&&$scope.articles.splice(i,1)}else $scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(){var article=$scope.article;article.$update(function(){$location.path("articles/"+article._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("articles/:articleId",{articleId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/members"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").directive("magnificPopup",[function(){return{restrict:"A",scope:{zoomEnabled:"&"},link:function(scope,element){$(element).magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0},mainClass:"mfp-with-zoom",zoom:{enabled:scope.zoomEnabled(),duration:300,easing:"ease-in-out",opener:function(openerElement){return openerElement.is("img")?openerElement:openerElement.find("img")}}})}}}]),angular.module("core").directive("imageload",[function(){return{restrict:"A",link:function(scope,element,attrs){var cssClass=attrs.loadedclass;element.bind("load",function(){angular.element(element).addClass(cssClass)})}}}]),angular.module("core").directive("bnLazySrc",["$window","$document",function($window,$document){function LazyImage(element){function isVisible(topFoldOffset,bottomFoldOffset){if(!element.is(":visible"))return!1;null===height&&(height=element.height());var top=element.offset().top,bottom=top+height;return bottomFoldOffset>=top&&top>=topFoldOffset||bottomFoldOffset>=bottom&&bottom>=topFoldOffset||topFoldOffset>=top&&bottom>=bottomFoldOffset}function render(){isRendered=!0,renderSource()}function setSource(newSource){source=newSource,isRendered&&renderSource()}function renderSource(){element[0].src=source}var source=null,isRendered=!1,height=null;return{isVisible:isVisible,render:render,setSource:setSource}}function link($scope,element,attrs){var lazyImage=new LazyImage(element);lazyLoader.addImage(lazyImage),attrs.$observe("bnLazySrc",function(newSource){lazyImage.setSource(newSource)}),$scope.$on("$destroy",function(){lazyLoader.removeImage(lazyImage)})}var lazyLoader=function(){function addImage(image){images.push(image),renderTimer||startRenderTimer(),isWatchingWindow||startWatchingWindow()}function removeImage(image){for(var i=0;i<images.length;i++)if(images[i]===image){images.splice(i,1);break}images.length||(clearRenderTimer(),stopWatchingWindow())}function checkDocumentHeight(){if(!renderTimer){var currentDocumentHeight=doc.height();currentDocumentHeight!==documentHeight&&(documentHeight=currentDocumentHeight,startRenderTimer())}}function checkImages(){console.log("Checking for visible images...");for(var visible=[],hidden=[],windowHeight=win.height(),scrollTop=win.scrollTop(),topFoldOffset=scrollTop,bottomFoldOffset=topFoldOffset+windowHeight,i=0;i<images.length;i++){var image=images[i];image.isVisible(topFoldOffset,bottomFoldOffset)?visible.push(image):hidden.push(image)}for(var i=0;i<visible.length;i++)visible[i].render();images=hidden,clearRenderTimer(),images.length||stopWatchingWindow()}function clearRenderTimer(){clearTimeout(renderTimer),renderTimer=null}function startRenderTimer(){renderTimer=setTimeout(checkImages,renderDelay)}function startWatchingWindow(){isWatchingWindow=!0,win.on("resize.bnLazySrc",windowChanged),win.on("scroll.bnLazySrc",windowChanged),documentTimer=setInterval(checkDocumentHeight,documentDelay)}function stopWatchingWindow(){isWatchingWindow=!1,win.off("resize.bnLazySrc"),win.off("scroll.bnLazySrc"),clearInterval(documentTimer)}function windowChanged(){renderTimer||startRenderTimer()}var images=[],renderTimer=null,renderDelay=100,win=$($window),doc=$document,documentHeight=doc.height(),documentTimer=null,documentDelay=2e3,isWatchingWindow=!1;return{addImage:addImage,removeImage:removeImage}}();return{restrict:"A",link:link}}]),angular.forEach(["x","y","width","height"],function(name){var ngName="ng"+name[0].toUpperCase()+name.slice(1);angular.module("core").directive(ngName,function(){return function(scope,element,attrs){attrs.$observe(ngName,function(value){attrs.$set(name,value)})}})}),angular.module("core").directive("ngXlinkHref",function(){return function(scope,element,attrs){attrs.$observe("ngXlinkHref",function(value){attrs.$set("xlink:href",value)})}}),angular.module("core").filter("shuffle",[function(){return function(array){for(var temporaryValue,randomIndex,currentIndex=array.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("members").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Members","members","dropdown","/members(/create)?"),Menus.addSubMenuItem("topbar","members","List Members","members"),Menus.addSubMenuItem("topbar","members","New Member","members/create")}]),angular.module("members").config(["$stateProvider",function($stateProvider){$stateProvider.state("listMembers",{title:"成員列表",url:"/members",templateUrl:"modules/members/views/list-members.client.view.html"}).state("viewMember",{url:"/members/:memberFullName",templateUrl:"modules/members/views/view-member.client.view.html"})}]),angular.module("members").controller("MembersController",["$scope","$filter","$http","$stateParams","$location","cfpLoadingBar","$document","$state",function($scope,$filter,$http,$stateParams,$location,cfpLoadingBar,$document,$state){$scope.toTheTop=function(){$document.scrollTopAnimated(0)},$scope.isLoading=!1,$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed};var loadingStart=function(){$scope.isLoading=!0,cfpLoadingBar.start()},loadingComplete=function(){$scope.isLoading=!1,cfpLoadingBar.complete()};$scope.find=function(){loadingStart(),$scope.canReverse=function(orderProp){return!!~["year","height"].indexOf(orderProp)},$http.get("modules/members/members.json").success(function(data){$scope.orderProp="team",angular.forEach(data,function(member){member.year=$filter("getAge")(member.birthday),member.catchphrase=member.catchphrase.replace("{0}",member.year),member.zodiacsign=$filter("getZodiacSign")(member.birthday)[1],member.zodiacsignsymbol=$filter("getZodiacSign")(member.birthday)[3],member.zodiacsignorder=$filter("getZodiacSign")(member.birthday)[2]}),$scope.members=data,loadingComplete()})},$scope.findOne=function(){$scope.canShowMember=!0,loadingStart(),$scope.members=null,$scope.member=null,$scope.keywords=null,$scope.relationships=null,$scope.details=null,$scope.d3Nodes=null,$scope.d3Links=null,$scope.currentGroup=0,$scope.svgWidth=0,$scope.svgHeight=0,$scope.onTargetMemberHover=null,$scope.onTargetMemberClick=null,$scope.images=null,$http.get("modules/members/members.json").error(function(data){console.log("HTTP get members.json error."),console.log(data)}).success(function(members){$scope.members=members;var member=$filter("getMemberIdByFullName")(members,$stateParams.memberFullName);$state.current.title=member.firstname+member.lastname,Tabletop.init({key:"1MlbQ8V-O2Q3vGmquuzqUV4whqtlTpzkKF6VFNTgsYx4",query:"memberid = "+member.memberid,callback:function(data,tabletop){$scope.$apply(function(){$scope.member=tabletop.sheets("member").all()[0],$scope.keywords=tabletop.sheets("keyword").all(),$scope.relationships=tabletop.sheets("relationship").all(),$scope.images=$filter("shuffle")(tabletop.sheets("image").all()),$scope.member.year=$filter("getAge")($scope.member.birthday),$scope.member.catchphrase=$scope.member.catchphrase.replace("{0}",$scope.member.year),$scope.member.zodiacsign=$filter("getZodiacSign")($scope.member.birthday)[1],$scope.member.zodiacsignsymbol=$filter("getZodiacSign")($scope.member.birthday)[3],$scope.member.img2014320=$filter("getImgURL")($scope.member.memberid,320,2014),$scope.member.img2013320=$filter("getImgURL")($scope.member.memberid,320,2013),$scope.member.img2012320=$filter("getImgURL")($scope.member.memberid,320,2012),$scope.member.img2011320=$filter("getImgURL")($scope.member.memberid,320,2011),$scope.member.img2014320s=$filter("getImgURL")($scope.member.memberid,320,2014,!0),$scope.member.img2013120s=$filter("getImgURL")($scope.member.memberid,120,2013,!0),$scope.member.img2012120s=$filter("getImgURL")($scope.member.memberid,120,2012,!0),$scope.member.img2011120s=$filter("getImgURL")($scope.member.memberid,120,2011,!0),$scope.member.tooltip=$filter("getHistoryTooltipTemplate")($scope.member.memberid,$scope.member.generation);var forceData=$filter("getForceData")($scope.relationships,members,$scope.member.memberid);$scope.d3Nodes=forceData.nodes,$scope.d3Links=forceData.links,$scope.details=forceData.details,$scope.currentGroup=0,$scope.svgWidth=585,$scope.svgHeight=555,$scope.onTargetMemberHover=function($event){var targetMemberId=angular.element($event.target).scope().node.memberid,group=$filter("getGroupByTartgetMemberId")($scope.d3Links,targetMemberId);$scope.currentGroup=group},$scope.onTargetMemberClick=function($event){var member=angular.element($event.target).scope().node,fullName=member.firstnameen+"-"+member.lastnameen;$location.path("members/"+fullName)};d3.layout.force().nodes($scope.d3Nodes).links($scope.d3Links).friction(.9).distance(100).charge(-5e3).gravity(.1).theta(.8).alpha(.1).size([$scope.svgWidth,$scope.svgHeight]).on("tick",function(){$scope.$apply()}).start()}),loadingComplete(),$scope.canShowMember=$scope.member.enabled,$scope.underConstructionText="敬請期待♥"}})})}}]),angular.module("members").filter("getMemberIdByFullName",[function(){return function(members,fullName){for(var nameAry=fullName.split("-"),firstName=nameAry[0],lastName=nameAry[1],i=0,len=members.length;len>i;i++)if(members[i].firstnameen===firstName&&members[i].lastnameen===lastName)return members[i];return null}}]).filter("getMemberById",[function(){return function(members,memberId){for(var i=0,len=members.length;len>i;i++)if(members[i].memberid==memberId)return members[i];return null}}]).filter("thumbnail",[function(){return function(imgurUrl,size){return void 0===imgurUrl?null:imgurUrl.slice(0,26)+size+imgurUrl.slice(26)}}]).filter("getImgURL",[function(){return function(memberId,size,year,isSquare){size=size||320,year=year||2014,isSquare=isSquare||!1;var regexp=function(str){return new RegExp(str.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g")};return"./modules/members/img/{2}/{1}{3}/{0}_{1}{3}_{2}.jpg".replace("{0}",("0000"+memberId).slice(-4)).replace(regexp("{1}"),size).replace(regexp("{2}"),year).replace(regexp("{3}"),isSquare?"s":"")}}]).filter("getGeneration",[function(){return function(generation){return 4==generation?"AKB48 三期生":6==generation?"AKB48 五期生":16==generation?"SKE48 四期生":20==generation?"HKT48 一期生":25==generation?"HKT48 二期生":29==generation?"HKT48 三期生":30==generation?"HKT48 選秀生":""}}]).filter("getGenerationDate",[function(){return function(generation){return 4==generation?11650752e5:6==generation?11916e8:16==generation?12832704e5:20==generation?13094496e5:25==generation?13464288e5:29==generation?13832352e5:30==generation?13840128e5:""}}]).filter("getTeam",[function(){return function(team){return 23==team?"AKB48 Team A":24==team?"AKB48 Team K":25==team?"AKB48 Team B":27==team?"SKE48 Team S":29==team?"SKE48 Team E":30==team?"NMB48 Team N":33==team?"Team H":34==team?"Team KIV":35==team?"研究生":""}}]).filter("getTeamDescription",[function(){return function(team){return 33==team?"雖然現役隊員與出道至今，曾經代表過整個HKT48的那個經典Team H大不相同，這個隊伍仍然保有Team H才華洋溢，天賦多得幾近奢侈的風格。在大組閣的大換血之後留下的成員並不多，但Team H在美人、搞笑、舞蹈每一個位置上，都能保持一名前輩配上數名具有潛力的後輩，在保持競爭力的前提下仍有大量新星令人期待。而隊伍最大的看點，就是現今全團最受矚目的矢吹奈子、田中美久，以及前後兩代Center兒玉遥、田島芽瑠，配上支配人指原莉乃，星光濯濯的核心陣容。":34==team?"與分班宣布前，眾人所預期的以二期生為主的隊伍完全相反，Team KIV事實上繼承了大量原H成員及一期生的天賦。Team KIV的陣容特色就宛如她們的劇場公演曲目一般──以數名守護劇場的「劇場的女神」為主，Team KIV的成員重團隊，彼此扶持，雖然是全48G最年幼的隊伍，卻一舉奪下了劇場公演競賽的后冠。而鎂光燈焦點的本村碧唯、森保まどか、朝長美桜，以及已經奪下關東Center的宮脇咲良，都與這個隊伍一樣，仍在持續成長，前途無可限量。":"在籍資歷最淺的她們，戰力並不容小覷。就算不提入團後立刻站c/w C，現已順利升格的奈子美久，三期研究生中也仍然有人進入選拔與劇場盤unit。研究生中有可愛蘿莉、有成熟美人、有人擅長舞蹈、有人立志綜藝；也許人數不多，但個個都是令人期待的，HKT可以倚靠的未來。"}}]).filter("getJob",[function(){return function(job){return 1==job?"HKT48 劇場支配人兼務":2==job?"Team H 隊長":3==job?"Team KIV 隊長":4==job?"Team H 副隊長":5==job?"Team KIV 副隊長":""}}]).filter("getForceData",["$filter",function($filter){return function(relationships,members,sourceMemberId){var data={nodes:[],links:[],details:[]},sourceMember=$filter("getMemberById")(members,sourceMemberId);sourceMember.img2014120=$filter("getImgURL")(sourceMemberId,120,2014,!0),data.nodes.push(sourceMember);for(var i=0,len=relationships.length;len>i;i++){var targetMemberId=relationships[i].targetmemberid,targetMember=$filter("getMemberById")(members,targetMemberId);targetMember.img2014120=$filter("getImgURL")(relationships[i].targetmemberid,120,2014,!0),data.nodes.push(targetMember);var link={source:0,target:i+1,memberid:relationships[i].memberid,targetmemberid:relationships[i].targetmemberid,relationshipdirection:relationships[i].relationshipdirection,group:relationships[i].group};data.links.push(link);var introductionMember=$filter("getMemberById")(members,relationships[i].introductionmemberid);if(parseInt(relationships[i].group)>=data.details.length){var detail={group:relationships[i].group,keyword:relationships[i].keyword,content:relationships[i].content,introduction:relationships[i].introduction,introductionsource:introductionMember.firstname+" "+introductionMember.lastname+" "+relationships[i].introductiondate,imgurl:relationships[i].imgurl};data.details.push(detail)}}return data}}]).filter("getGroupByTartgetMemberId",[function(){return function(links,targetMemberId){for(var i=0,len=links.length;len>i;i++)if(links[i].targetmemberid==targetMemberId)return links[i].group;return 0}}]).filter("groupBy",["$parse",function($parse){return function(list,groupBy){var filtered=[],prevItem=null,groupChanged=!1,newFiled="groupByCHANGED";return angular.forEach(list,function(item){if(groupChanged=!1,null!==prevItem){groupBy=angular.isArray(groupBy)?groupBy:[groupBy];for(var i=0,len=groupBy.length;len>i;i++)$parse(groupBy[i])(prevItem)!==$parse(groupBy[i])(item)&&(groupChanged=!0)}else groupChanged=!0;item[newFiled]=groupChanged?!0:!1,filtered.push(item),prevItem=item}),filtered}}]).filter("getAge",[function(){return function(birthday){return Math.floor(((new Date).getTime()-birthday)/31536e6)}}]).filter("getZodiacSign",[function(){return function(birthday){var date=new Date(parseInt(birthday)),dateStr=+[date.getMonth()+1,("0"+date.getDate()).slice(-2)].join(""),signs=[[120,"摩羯座",10,"♑"],[219,"寶瓶座",11,"♒"],[320,"雙魚座",12,"♓"],[420,"白羊座",1,"♈"],[521,"金牛座",2,"♉"],[621,"雙子座",3,"♊"],[722,"巨蟹座",4,"♋"],[822,"獅子座",5,"♌"],[923,"室女座",6,"♍"],[1023,"天秤座",7,"♎"],[1122,"天蠍座",8,"♏"],[1221,"人馬座",9,"♐"],[1231,"摩羯座",10,"♑"]];for(var index in signs){var item=signs[index];if(dateStr<=item[0])return item}}}]).filter("getBloodType",[function(){return function(bloodType){return 1==bloodType?"A":2==bloodType?"B":3==bloodType?"AB":4==bloodType?"O":"不明"}}]).filter("getJapanPlace",[function(){return function(place){return 11==place?"埼玉縣":13==place?"東京都":23==place?"愛知縣":35==place?"山口縣":38==place?"愛媛縣":40==place?"福岡縣":41==place?"佐賀縣":42==place?"長崎縣":43==place?"熊本縣":44==place?"大分縣":45==place?"宮崎縣":46==place?"鹿兒島縣":"不明"}}]).filter("getJapanZone",[function(){return function(place){var placeNum=parseInt(place);return 1==placeNum?"北海道地方":placeNum>=1&&8>placeNum?"東北地方":placeNum>=8&&15>placeNum?"關東地方":placeNum>=15&&24>placeNum?"中部地方":placeNum>=24&&31>placeNum?"近畿地方":placeNum>=31&&36>placeNum?"中國地方":placeNum>=36&&40>placeNum?"四國地方":placeNum>=40&&47>placeNum?"九州地方":47==placeNum?"沖繩地方":"海外"}}]).filter("capitalize",[function(){return function(string){return string?string.charAt(0).toUpperCase()+string.slice(1):string}}]).filter("getHistoryTooltipTemplate",["$filter",function($filter){return function(memberId,generation){var li="<li><div><img class='img-circle' src='{0}'><p class='text-center'>{1}</p></div></li>",regexp=function(str){return new RegExp(str.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g")},template=function(year){var url=$filter("getImgURL")(memberId,120,year,!0);return li.replace(regexp("{0}"),url).replace(regexp("{1}"),year)},generationDate=new Date($filter("getGenerationDate")(generation)),generationYear=generationDate.getFullYear(),ul="<ul><div>";return(2006===generationYear||2007===generationYear)&&(ul+=template(2013),ul+=template(2012)),2013===generationYear&&(ul+=template(2013)),2012===generationYear&&(ul+=template(2013),ul+=template(2012)),2011===generationYear&&(ul+=template(2013),ul+=template(2012),ul+=template(2011)),ul+="</div></ul>"}}]),angular.module("members").factory("Members",["$resource",function($resource){return $resource("members/:memberId",{memberId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invlaid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);
